<!doctype html>
<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="theme-color" content="#1f2e45" />
    <title>EPRIS Админка контента</title>
    <link rel="stylesheet" href="./styles.css" />
  </head>
  <body>
    <div class="ambient"></div>
    <main class="layout">
      <section class="panel panel-config">
        <header class="brand">
          <p class="kicker">eprisj.github.io / панель редактора</p>
          <h1>Панель управления контентом EPRIS</h1>
          <p class="muted">
            Здесь можно менять разделы, статьи и карточки сайта без кода. Все данные берутся из файла <code>src/content/site-content.json</code>.
          </p>
          <div class="brand-actions">
            <a href="../" class="link">Открыть сайт</a>
            <button id="copySiteBtn" class="btn btn-ghost" type="button">Скопировать URL админки</button>
          </div>
        </header>

        <section class="quick-steps" aria-label="Быстрый старт">
          <article class="step-card">
            <p class="step-num">Шаг 1</p>
            <p class="step-title">Загрузите контент</p>
            <p class="step-text">Вставьте GitHub Token и нажмите <strong>Загрузить из GitHub</strong>.</p>
          </article>
          <article class="step-card">
            <p class="step-num">Шаг 2</p>
            <p class="step-title">Измените нужный раздел</p>
            <p class="step-text">Выберите раздел, язык и запись в визуальном редакторе справа.</p>
          </article>
          <article class="step-card">
            <p class="step-num">Шаг 3</p>
            <p class="step-title">Сохраните</p>
            <p class="step-text">Нажмите <strong>Сохранить в GitHub</strong>. Сайт обновится после деплоя автоматически.</p>
          </article>
        </section>

        <section class="guide" aria-label="Инструкция">
          <p class="guide-title">Что важно знать</p>
          <ol class="guide-list">
            <li><strong>Обязательно:</strong> вставьте GitHub Token с доступом <code>Contents: Read and write</code>.</li>
            <li><strong>Нажмите:</strong> <code>Загрузить из GitHub</code>.</li>
            <li><strong>Редактируйте справа:</strong> <code>articles</code>, <code>items</code>, <code>reviews</code>, <code>libraryItems</code>.</li>
            <li><strong>Нажмите:</strong> <code>Сохранить в GitHub</code>.</li>
          </ol>
          <p class="guide-note">Фото можно ставить по URL: в полях <code>URL фото</code> / <code>URL обложки</code>. Если URL пустой, используется <code>imageSeed</code>.</p>
        </section>

        <div class="quick-row">
          <button id="applyDefaultsBtn" class="btn" type="button">Стандартные eprisj</button>
          <button id="resetSettingsBtn" class="btn" type="button">Сбросить настройки</button>
          <label class="inline switch" for="autoLoadOnStart">
            <input id="autoLoadOnStart" type="checkbox" />
            Автозагрузка JSON при открытии
          </label>
        </div>

        <div id="repoSummary" class="repo-summary"></div>

        <div class="grid">
          <label>
            Владелец GitHub (обычно не менять)
            <input id="owner" placeholder="your-org-or-user" value="eprisj" />
          </label>
          <label>
            Репозиторий (обычно не менять)
            <input id="repo" placeholder="repo-name" value="eprisj.github.io" />
          </label>
          <label>
            Ветка (обычно не менять)
            <input id="branch" placeholder="main" value="main" />
          </label>
          <label>
            Путь к файлу (обычно не менять)
            <input id="path" value="src/content/site-content.json" />
          </label>
          <label class="full">
            Папка для загружаемых фото
            <input id="uploadDir" value="public/uploads" placeholder="public/uploads" />
          </label>
          <label class="full">
            GitHub Token (fine-grained PAT, доступ Contents: Read and write)
            <input id="token" type="password" autocomplete="off" placeholder="github_pat_..." />
          </label>
          <label class="full inline" for="rememberToken">
            <input id="rememberToken" type="checkbox" />
            Запомнить токен в этом браузере
          </label>
          <label class="full">
            Комментарий коммита (можно оставить как есть)
            <input id="message" value="chore(content): обновление контента через админку" />
          </label>
        </div>

        <div class="actions">
          <button id="loadBtn" class="btn" type="button">Загрузить из GitHub</button>
          <button id="validateBtn" class="btn" type="button">Проверить JSON</button>
          <button id="formatBtn" class="btn" type="button">Форматировать JSON</button>
          <button id="downloadBtn" class="btn" type="button">Скачать JSON</button>
          <button id="saveBtn" class="btn btn-primary" type="button">Сохранить в GitHub</button>
        </div>

        <p id="status" class="status">Готово.</p>
        <p id="editorState" class="editor-state">Нет локальных изменений.</p>
        <div id="stats" class="stats"></div>
      </section>

      <section class="panel panel-editor">
        <div class="visual-editor">
          <div class="visual-intro">
            <p class="visual-intro-title">Визуальный редактор</p>
            <p class="visual-intro-text">Рекомендуемый режим для обычной работы. Сырой JSON ниже нужен только для сложных правок.</p>
          </div>
          <div class="visual-toolbar">
            <label>
              Раздел
              <select id="visualSection">
                <option value="articles">Статьи</option>
                <option value="reviews">Обзоры</option>
                <option value="items">Галерея</option>
                <option value="libraryItems">Библиотека</option>
              </select>
            </label>
            <label>
              Язык контента
              <select id="visualLang"></select>
            </label>
            <label class="visual-entry-label">
              Запись
              <select id="visualEntry"></select>
            </label>
            <label>
              Поиск записи
              <input id="visualSearch" placeholder="id, заголовок..." />
            </label>
            <div class="visual-buttons">
              <button id="addEntryBtn" class="btn" type="button">+ Добавить</button>
              <button id="duplicateEntryBtn" class="btn" type="button">Дублировать</button>
              <button id="deleteEntryBtn" class="btn" type="button">Удалить</button>
              <button id="copyFromEnBtn" class="btn" type="button">Копия из EN</button>
              <button id="applyEntryBtn" class="btn btn-primary" type="button">Применить изменения</button>
            </div>
          </div>
          <p id="visualNotice" class="visual-notice">Выберите запись для редактирования.</p>

          <section class="upload-panel" aria-label="Загрузка фото">
            <div class="upload-head">
              <p class="upload-title">Загрузка фото в GitHub (drag-and-drop)</p>
              <p class="upload-text">Перетащите изображение сюда или выберите файл. После загрузки URL можно сразу подставить в поле текущей записи.</p>
            </div>

            <div id="uploadDropZone" class="upload-dropzone" tabindex="0" role="button" aria-label="Зона загрузки изображения">
              <p class="upload-drop-main">Перетащите фото сюда</p>
              <p class="upload-drop-sub">или нажмите, чтобы выбрать файл</p>
              <button id="pickImageBtn" class="btn" type="button">Выбрать файл</button>
              <input id="imageFileInput" type="file" accept="image/*" hidden />
            </div>

            <label class="full">
              URL загруженного файла
              <input id="uploadedImageUrl" readonly placeholder="После загрузки здесь появится ссылка" />
            </label>

            <div class="upload-buttons">
              <button id="useUploadedUrlBtn" class="btn" type="button">Подставить URL в текущую запись</button>
              <button id="copyUploadedUrlBtn" class="btn" type="button">Скопировать URL</button>
            </div>

            <p id="uploadHint" class="upload-hint">Файл будет загружен в папку из поля «Папка для загружаемых фото».</p>
          </section>

          <div id="visualForm" class="visual-form"></div>
        </div>

        <details class="raw-panel">
          <summary>Сырой JSON (для продвинутого редактирования)</summary>
          <div class="editor-top">
            <label class="editor-label" for="editor">JSON контента</label>
            <p class="shortcuts">Ctrl/Cmd+S: сохранить в GitHub, Ctrl/Cmd+Shift+L: загрузить, Ctrl/Cmd+Shift+F: форматировать</p>
            <p class="shortcuts">Подсказка: <code>items</code> = галерея, <code>articles</code> = статьи, <code>reviews</code> = обзоры, <code>libraryItems</code> = библиотека.</p>
          </div>
          <textarea id="editor" spellcheck="false"></textarea>
        </details>
      </section>
    </main>

    <script src="./app.js" type="module"></script>
  </body>
</html>
